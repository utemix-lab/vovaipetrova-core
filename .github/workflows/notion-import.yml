name: Notion import to docs

on:

workflow_dispatch:

inputs:

zip_path:

description: 'Путь к ZIP внутри репозитория (например, uploads/notion_[export.zip](http://export.zip))'

required: true

default: 'uploads/notion_[export.zip](http://export.zip)'

push:

paths:

- 'uploads/*.zip'

jobs:

import:

runs-on: ubuntu-latest

steps:

- name: Checkout
    
    uses: actions/checkout@v4
    
- name: Ensure tools
    
    run: |
    
    sudo apt-get update -y
    
    sudo apt-get install -y unzip
    
- name: Prepare paths
    
    id: prep
    
    run: |
    
    ZIP_PATH="$ [github.event.inputs.zip](http://github.event.inputs.zip)_path "
    
    if [ -z "$ZIP_PATH" ]; then
    
    # для триггера push берём изменённый zip
    
    ZIP_PATH="$(git diff --name-only HEAD~1 | grep -E '^uploads/.*.zip$' | head -n1 || true)"
    
    fi
    
    if [ -z "$ZIP_PATH" ]; then
    
    echo "No ZIP found. Set [inputs.zip](http://inputs.zip)_path or push a ZIP to uploads/"; exit 1
    
    fi
    
    echo "zip=$ZIP_PATH" >> $GITHUB_OUTPUT
    
    mkdir -p tmp/unzip docs
    
- name: Unzip main export
    
    run: |
    
    unzip -q "$ [steps.prep.outputs.zip](http://steps.prep.outputs.zip) " -d tmp/unzip || true
    
    # Если экспорт разбит на части, разархивируем Part-*.zip
    
    find tmp/unzip -maxdepth 1 -type f -name 'ExportBlock-*-Part-*.zip' -print0 | xargs -0 -I{} unzip -q "{}" -d tmp/unzip || true
    
    echo "After unzip:"; ls -la tmp/unzip | head -n 100
    
- name: Copy raw export into docs
    
    run: |
    
    # Копируем ВСЁ содержимое экспорта в docs/, не переименовываем
    
    shopt -s dotglob
    
    cp -R tmp/unzip/* docs/ 2>/dev/null || true
    
    echo "Docs tree:"; ls -la docs | head -n 200
    
- name: Commit changes
    
    env:
    
    GIT_AUTHOR_NAME: github-actions
    
    GIT_AUTHOR_EMAIL: [actions@users.noreply.github.com](mailto:actions@users.noreply.github.com)
    
    GIT_COMMITTER_NAME: github-actions
    
    GIT_COMMITTER_EMAIL: [actions@users.noreply.github.com](mailto:actions@users.noreply.github.com)
    
    run: |
    
    git add docs
    
    if git diff --cached --quiet; then
    
    echo "No changes to commit."
    
    else
    
    git commit -m "chore: import Notion export (raw)"
    
    git push
    
    fi
