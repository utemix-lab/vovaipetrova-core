---
title: Single Source Playbook — «священный документ» (Notion↔Repo)
slug: single-source-playbook
summary: Единый источник истины для синхронизации между Notion и GitHub репозиторием. Правила, процессы и чек-листы для поддержания консистентности.
status: draft
tags:
  - Автоматизация
  - Проектирование
machine_tags:
  - action/build
  - product/services
  - theme/automation
  - theme/dev
---

# Single Source Playbook — «священный документ» (Notion↔Repo)

## 1. Основы синхронизации

### Принцип

- **Notion** — Source of truth, постановка задач, принятие решений
- **GitHub** — Зеркало, выполнение, CI/CD, публикация

### Направления синхронизации

- **Notion → GitHub:** Задачи берутся по MCP (из базы Briefs), работа выполняется
- **GitHub → Notion:** Статусы, ссылки на PR и отчёты возвращаются по MCP
- **Двусторонняя синхронизация:** Через агентов (Cursor, Copilot и другие)

**Важно:** Задачи создаются только в Notion. GitHub Issues — только для CI/CD-техники.

Подробнее см. [ADR — Source of truth и зеркалирование](adr-source-of-truth-i-zerkalirovanie.md).

---

## 2. Быстрый старт (чек-лист)

1. Взять задачу из Briefs через MCP
2. Самостоятельно выбрать оптимальное решение
3. Выполнить работу → PR
4. После завершения всех команд — открыть PR или дать ссылку
5. PR: заголовок и тело по-русски, UTF-8, без моджибаке
6. Команды агентам — по-русски, сгруппированы
7. В чат: "PR готов, проверьте и смержите" (без вариантов)
8. При правках → re-run → исправить
9. Перед каждым коммитом — двойной контроль ветки
10. После merge → отчёт в Notion → взять новую задачу

---

## 3. Работа над задачами

### 3.1. Получение

**Обязательное правило:** Все задачи берутся по MCP из базы Briefs (Notion).

- ❌ **Запрещено** использовать GitHub Issues как источник работы
- ❌ **Не начинать** работу без задачи из Notion
- ✅ **Использовать** MCP сервер для получения задачи из Notion
- ✅ **Проверять** статус задачи в Notion перед началом работы

**Документация по MCP:**
- [MCP Quickstart](../MCP-QUICKSTART.md) — быстрый старт с MCP сервером
- [Настройка Copilot с MCP](copilot-mcp-setup.md) — настройка GitHub Copilot для работы с Notion через MCP

### 3.2. Решение

**Типы задач и варианты решений:**

- **Техническая задача:** Не предлагать варианты проверяющему. Фиксировать в Notion (только если не принято решение)
- **Творческая задача:** Можно кратко предложить варианты. Фиксировать аналогично

**Правила:**

- ✅ **Выбирать** оптимальное решение самостоятельно
- ✅ **Не предлагать** варианты проверяющему на стадии PR (для технических задач)
- ⚠️ **Исключение:** Для творческих задач можно предлагать варианты кратко и ёмко
- ✅ **Указывать** в отчёте Notion раздел "Возможные варианты и выбранный путь" **только если проверяющий не принял решение** (чтобы избежать непонимания вопросов)

---

## 3.3. Границы ответственности

### Исполнитель (Cursor/Copilot/другие агенты)

**Ответственность:**

- ✅ Получение задачи из Notion через MCP
- ✅ Выполнение технической работы (код, документация, скрипты)
- ✅ Выбор оптимального решения при наличии вариантов
- ✅ Создание PR с корректным заголовком и описанием
- ✅ Исправление ошибок после ревью
- ✅ Отчёт в Notion после завершения задачи
- ✅ Следование техническим требованиям (UTF-8, структура файлов, линтеры)

**Не ответственность:**

- ❌ Принятие стратегических решений (это делает проверяющий)
- ❌ Мердж PR (это делает проверяющий)
- ❌ Удаление веток (это делает проверяющий)
- ❌ Изменение структуры проекта без согласования
- ❌ Работа без задачи из Notion

### Проверяющий (человек)

**Ответственность:**

- ✅ Постановка задач в Notion (Briefs)
- ✅ Принятие решений по вариантам реализации
- ✅ Ревью PR (проверка кода, логики, соответствия требованиям)
- ✅ Мердж PR после успешного ревью
- ✅ Удаление веток после мерджа
- ✅ Уведомление исполнителя о завершении работы
- ✅ Координация работы между задачами

**Не ответственность:**

- ❌ Выполнение технической работы (это делает исполнитель)
- ❌ Исправление ошибок в коде (это делает исполнитель после ревью)
- ❌ Написание кода вместо исполнителя

### Разделение зон ответственности

**Технические решения:**

- **Исполнитель:** Выбирает оптимальное техническое решение из вариантов
- **Проверяющий:** Принимает решение, если варианты требуют стратегического выбора

**Творческие решения:**

- **Исполнитель:** Может предложить варианты кратко
- **Проверяющий:** Принимает финальное решение

**Процесс работы:**

- **Исполнитель:** Выполняет → PR → Исправляет после ревью → Отчёт
- **Проверяющий:** Ставит задачу → Ревьюит → Мерджит → Уведомляет

---

## 3.4. Правило-решалка (Decision Tree)

Используйте эту схему для принятия решений в процессе работы:

```
Начало работы
    │
    ├─ Есть задача в Notion (Briefs)?
    │   ├─ НЕТ → Взять задачу через MCP
    │   └─ ДА → Продолжить
    │
    ├─ Задача понятна?
    │   ├─ НЕТ → Уточнить у проверяющего
    │   └─ ДА → Продолжить
    │
    ├─ Есть варианты решения?
    │   ├─ НЕТ → Выполнить работу
    │   │
    │   └─ ДА → Это техническая задача?
    │       ├─ ДА → Выбрать оптимальный вариант самостоятельно
    │       │       → Выполнить работу
    │       │
    │       └─ НЕТ (творческая) → Кратко предложить варианты
    │                             → Дождаться решения проверяющего
    │                             → Выполнить работу
    │
    ├─ Работа выполнена?
    │   ├─ НЕТ → Продолжить выполнение
    │   └─ ДА → Проверить ветку (двойная проверка)
    │
    ├─ Ветка корректна?
    │   ├─ НЕТ → Исправить → Вернуться к проверке
    │   └─ ДА → Создать PR
    │
    ├─ PR создан?
    │   ├─ НЕТ → Создать PR (заголовок и описание по-русски, UTF-8)
    │   └─ ДА → Сообщить в чат: "PR готов, проверьте и смержите"
    │
    ├─ Есть комментарии от проверяющего?
    │   ├─ ДА → Исправить ошибки → Перезапустить CI (re-run)
    │   │       → Вернуться к проверке комментариев
    │   └─ НЕТ → Дождаться мерджа
    │
    ├─ PR смёрджен?
    │   ├─ НЕТ → Дождаться мерджа
    │   └─ ДА → Проверяющий удалил ветку?
    │       ├─ НЕТ → Дождаться удаления
    │       └─ ДА → Написать отчёт в Notion
    │
    └─ Отчёт написан?
        ├─ НЕТ → Написать отчёт через MCP
        └─ ДА → Взять следующую задачу из Notion
```

### Быстрые правила принятия решений

**Когда выбирать решение самостоятельно:**
- Техническая задача с несколькими вариантами реализации
- Варианты равнозначны по качеству
- Выбор не влияет на стратегию проекта

**Когда спрашивать проверяющего:**
- Творческая задача с вариантами оформления/контента
- Решение влияет на стратегию проекта
- Варианты существенно различаются по подходу
- Задача неясна или требует уточнения

**Когда исправлять ошибки:**
- После комментариев от проверяющего
- После комментариев от CI ботов
- После обнаружения ошибок в процессе работы

**Когда писать отчёт:**
- После мерджа PR
- После удаления ветки проверяющим
- Перед взятием следующей задачи

---

## 4. Коммуникация с агентами

**Правила выполнения команд:**

- ✅ Команды — по-русски
- ✅ Максимально группировать
- ✅ Не дробить на мелкие подтверждения
- ✅ Группировать связанные команды в один блок

---

## 5. Pull Request

### 5.1. Перед созданием

1. Убедиться, что выполнены все команды
2. Проверить нумерацию PR
3. Контроль ветки (см. раздел 9)

### 5.2. PR

**Требования к PR:**

- **Заголовок:** Русский, UTF-8, без моджибаке
- **Описание:** Русский, UTF-8, без моджибаке
- **Открытие PR:** Только после завершения всех команд

**Отчёт о готовности PR в чат:**

- Кратко, по-русски
- Без предложений вариантов действий
- Одно действие: **"PR готов, проверьте и смержите"**

---

## 6. Работа после PR

**Перезапуск PR после правок:**

1. Внести правки в код/документацию
2. Закоммитить изменения
3. Запушить в ту же ветку
4. Перезапустить проверки CI с очисткой старых комментариев:
   ```bash
   npm run pr:rerun -- --pr=<номер_pr>
   ```
   Или вручную:
   - Очистить старые CI комментарии (оставляем Cursor Bugbot)
   - Перезапустить CI проверки через GitHub UI или пустой коммит
5. Дождаться завершения проверок
6. Проверяющий сообщает: **"Проверка ботами прошла, прочти комментарии, исправь ошибки."**
7. Исполнитель читает комментарии ботов и исправляет ошибки
8. Если правок несколько — перезапускать PR каждый раз

**Команда для перезапуска PR:**
- `npm run pr:rerun -- --pr=<номер>` — очищает старые CI комментарии и перезапускает проверки
- Комментарии Cursor Bugbot сохраняются
- Старые комментарии от `github-actions[bot]` удаляются

**Чтение комментариев ботов:**

Агенты могут самостоятельно читать комментарии от `github-actions[bot]` (CI проверки) и `cursor[bot]` (Cursor Bugbot), ориентируясь по времени комментариев (новые vs старые).

---

## 7. Отчётность

### 7.1. В чат — после PR

**Только:** "PR готов, проверьте и смержите"

### 7.2. В Notion — после merge перед следующей задачей

**Когда:** Перед стартом следующей задачи (после завершения предыдущей)

**Формат:**
- Статус задачи: `Done`
- Ссылка на PR (если доступно)
- Краткое описание выполненного
- Раздел "Возможные варианты и выбранный путь" **только если проверяющий не принял решение**

**После merge и удаления ветки:**

1. Проверяющий сам мерджит PR и удаляет ветку
2. Проверяющий говорит в чат: **"Смёрджил, ветку удалил. Напиши отчет по этой задаче Notion и возьми задачу ..."**
3. Исполнитель пишет отчёт в Notion по MCP о завершённой задаче
4. Исполнитель берёт следующую задачу из Notion (Briefs)

---

## 8. Технические требования

### 8.1. Кодировка UTF-8 (без BOM)

**Обязательное правило:** Все файлы должны быть в кодировке UTF-8 без BOM.

**Настройка редактора:**

1. В репозитории уже есть `.editorconfig` и `.vscode/settings.json`
2. VS Code/Cursor автоматически подхватывают эти настройки
3. Все новые файлы будут создаваться в UTF-8

**Проверка кодировки:**

1. Откройте файл в VS Code/Cursor
2. Посмотрите в правый нижний угол статус-бара
3. Должно быть указано "UTF-8"
4. Если указана другая кодировка, кликните на неё и выберите "Reopen with Encoding" → "UTF-8"

**Правила работы:**

- Перед сохранением: убедиться, что в статус-баре указано "UTF-8"
- Перед коммитом: проверить файлы на моджибаке (открыть в другом редакторе или на GitHub)
- При работе с PR: заголовок и тело PR — по-русски, **без моджибаке**

**Настройка Git (глобально):**

```bash
git config --global core.quotepath false
git config --global i18n.commitencoding utf-8
git config --global i18n.logoutputencoding utf-8
```

**Исправление файла с моджибаке:**

**В VS Code/Cursor:**
1. Открыть файл
2. Кликнуть на кодировку в статус-баре
3. Выбрать "Reopen with Encoding" → "UTF-8"
4. Сохранить файл

**В PowerShell (Windows-1251 → UTF-8):**

```powershell
$content = [System.IO.File]::ReadAllText('file.md', [System.Text.Encoding]::GetEncoding('Windows-1251'))
$utf8 = New-Object System.Text.UTF8Encoding $false
[System.IO.File]::WriteAllText('file.md', $content, $utf8)
```

Подробные инструкции см. в [UTF-8-SETUP.md](UTF-8-SETUP.md).

---

## 9. Контроль веток

**Обязательное правило:**

- ✅ **Внимательно следить** за текущей рабочей веткой
- ✅ **Двойная проверка** перед каждым коммитом: `git branch --show-current`
- ✅ **Лучше лишний раз перепроверить**, чем коммитить в неправильную ветку
- ✅ При ошибочных коммитах в другую ветку — исправить и обновить правила в памяти

**При создании новой ветки:**

- Использовать префиксы: `feat/`, `fix/`, `docs/`, `chore/`
- Название ветки должно отражать суть изменений

---

## 10. Final checklist перед PR

- [ ] Задача взята из Notion (MCP)
- [ ] Решение выбрано
- [ ] Команды выполнены
- [ ] Ветка проверена
- [ ] Нумерация PR проверена
- [ ] PR по-русски, UTF-8
- [ ] Команды в чате сгруппированы
- [ ] Ссылка/открытие PR — после всех команд
- [ ] Сообщение в чат: "PR готов, проверьте и смержите"

---

## 11. Удержание в памяти

**Важно:**

- ✅ Держать этот документ в TO-DO/кор-мемори
- ✅ Не нарушать последовательность
- ✅ При сбое — вернуться к документу

---

## Ссылки

### Основные документы

- [PROTOCOL — Контрактная модель для агентов](SINGLE-SOURCE-PLAYBOOK.md) (этот документ)
- [ADR — Source of truth и зеркалирование](adr-source-of-truth-i-zerkalirovanie.md)
- [Think Tank — компактное ядро](think-tank-kompaktnoe-yadro.md)

### Концепции

- [CONCEPT.stories-dual](stories/SHARED_CONTEXT.md) — двойной формат Stories
- [CONCEPT.author-gateway](GATEWAY-WATCHER.md) — Gateway Watcher для авторов

### Руководства

- [CONTRIBUTING.stories](CONTRIBUTING.stories.md) — гайд для авторов/редакторов Stories
- [UTF-8-SETUP.md](UTF-8-SETUP.md) — настройка UTF-8 кодировки в редакторах
- [MCP Quickstart](../MCP-QUICKSTART.md) — быстрый старт с MCP сервером для работы с Notion
- [Настройка Copilot с MCP](copilot-mcp-setup.md) — настройка GitHub Copilot для работы с Notion через MCP
- [KB policies](stories/README.md) — политики для Knowledge Base

---

## Связано с

- [ADR — Source of truth и зеркалирование](adr-source-of-truth-i-zerkalirovanie.md)
- [Think Tank — компактное ядро](think-tank-kompaktnoe-yadro.md)
- [Playbook — Роли](playbook-roli.md)
- [Инструкции для Notion AI](instrukcii-dlya-notion-ai-vovaipetrova.md)
- [Резервное копирование и экспорт](backup-export-routine-notion-github.md)
- [Экспорт в GitHub — руководство и шаблоны](eksport-v-github-rukovodstvo-i-shablony.md)
- [Инструкции для исполнителей](instructions-ispolniteli-cursoraider.md)
