---
title: Single Source Playbook — «священный документ» (Notion↔Repo)
slug: single-source-playbook
summary: Единый источник истины для синхронизации между Notion и GitHub репозиторием. Правила, процессы и чек-листы для поддержания консистентности.
status: draft
tags:
  - Автоматизация
  - Проектирование
machine_tags:
  - action/build
  - product/services
  - theme/automation
  - theme/dev
---

# Single Source Playbook — «священный документ» (Notion↔Repo)

## TL;DR

**Single Source Playbook** — это «священный документ», определяющий единый источник истины и правила синхронизации между Notion (источник истины) и GitHub репозиторием (зеркало для исполнения и публикации).

## Принцип Single Source of Truth

### Источник истины: Notion

- **Notion** — место правды для архитектурных решений, правил, процессов и документации
- **GitHub** — зеркало для публикации, предпросмотра, CI/CD и истории изменений
- Все изменения структуры и правил вносятся в Notion, затем синхронизируются в GitHub

### Два потока синхронизации

**Stream 1: Notion → GitHub (импорт)**
- Направление: Notion → GitHub
- Тип: Автоматический импорт через workflow `notion-import.yml`
- Использование: Импорт контента, документации, структуры из Notion в GitHub
- Ветки: `notion-sync/*` (автоматически создаются workflow)
- Процесс: Экспорт из Notion → ZIP в `uploads/` → запуск workflow → создание PR

**Stream 2: GitHub → Notion (синхронизация)**
- Направление: GitHub → Notion
- Тип: Ручная/автоматическая синхронизация через Copilot агентов
- Использование: Обновление статусов задач, синхронизация прогресса, обратная связь
- Ветки: Любые ветки агентов (`chore/*`, `feat/*`, `docs/*`, и т.д.)
- Процесс: Агент выполняет задачу → создаёт PR → после мерджа обновляет статус в Notion

## Структура «священного документа»

### 1. Notion Brain (источник истины)

**Что хранится в Notion:**
- Vision, ADR, Specs — архитектурные решения
- Briefs — задачи и их статусы
- Playbooks — процессы и правила работы
- Context maps — структура и связи
- Templates — шаблоны для задач, PR, ADR

**Что экспортируется в GitHub:**
- Компактный пакет `notion-brain/` (ADR/Specs/Instructions/context-map)
- Документация в `docs/` (через workflow импорта)
- Структура и правила в `.github/` и `docs/protocol-*.md`

### 2. GitHub Repository (зеркало)

**Что хранится в GitHub:**
- `docs/` — документация и контент (синхронизируется из Notion)
- `prototype/` — UI прототип (живёт в репо)
- `scripts/` — утилиты и скрипты автоматизации
- `.github/workflows/` — CI/CD workflows
- `docs/protocol-kontraktnaya-model-dlya-agentov.md` — правила для агентов

**Что НЕ синхронизируется обратно в Notion:**
- Код скриптов и workflows
- Автогенерируемые файлы (`prototype/data/**`, `prototype/page/**`)
- Временные файлы и кэши

## Правила синхронизации

### Правила для агентов (Copilot)

**При работе с Stream 1 (Notion → GitHub):**
- ❌ **Не изменять** файлы, импортированные из Notion (`notion_page_id` присутствует)
- ❌ **Не создавать** задачи в Notion для импортированного контента
- ✅ **Использовать** workflow `notion-import.yml` для импорта
- ✅ **Проверять** безопасность импорта через `check-import-safety.mjs`
- ✅ **Распознавать** ветки `notion-sync/*` как односторонний импорт

**При работе с Stream 2 (GitHub → Notion):**
- ✅ **Обновлять** статусы задач в Notion после завершения работы
- ✅ **Использовать** MCP сервер для обновления статусов через Copilot
- ✅ **Синхронизировать** статусы: `Ready` → `In Progress` → `Review` → `Done`
- ✅ **Добавлять** ссылку на PR в поле задачи (если доступно)
- ❌ **Не создавать** дубликаты задач в Notion для работы, начатой в GitHub

### Правила для людей

**При изменении структуры или правил:**
1. Изменить в Notion (источник истины)
2. Экспортировать через workflow `notion-import.yml`
3. Проверить созданный PR
4. После мерджа — проверить синхронизацию

**При работе с кодом и скриптами:**
1. Работать напрямую в GitHub
2. Создавать PR с описанием изменений
3. После мерджа — обновить статус задачи в Notion (если задача из Notion)

## Чек-лист синхронизации

### Перед экспортом из Notion

- [ ] Все изменения внесены в Notion
- [ ] Структура проверена и согласована
- [ ] Экспорт выполнен (Markdown & CSV, с подстраницами)
- [ ] ZIP файл помещён в `uploads/notion_export.zip`

### После импорта в GitHub

- [ ] PR создан через workflow `notion-import.yml`
- [ ] Проверка безопасности импорта пройдена (`check-import-safety.mjs`)
- [ ] Нормализация выполнена (`npm run normalize`)
- [ ] Линтинг пройден (`npm run lint:docs`)
- [ ] CI проверки зелёные (`Docs CI`)
- [ ] PR проверен и готов к мержу

### После мерджа PR

- [ ] Статус задачи в Notion обновлён на `Done` (если задача из Notion)
- [ ] Ссылка на PR добавлена в поле задачи (если доступно)
- [ ] Ветка удалена (если не `notion-sync/*`)

## Риски и митигация

### Риск: Рассинхронизация

**Проблема:** Notion и GitHub могут рассинхронизироваться при ручных правках.

**Митигация:**
- Чёткое разделение ответственности (Notion — структура, GitHub — код)
- Автоматические проверки через CI (`check-import-safety.mjs`)
- Чек-листы перед экспортом и после импорта
- Явные экспорты только `notion-brain/` (не всего контента)

### Риск: Конфликты при синхронизации

**Проблема:** Одновременные изменения в Notion и GitHub могут создать конфликты.

**Митигация:**
- Правило "один PR на lane" предотвращает конфликты
- Ветки `notion-sync/*` автоматически пропускают проверку lanes
- Двухпотоковая модель разделяет направления синхронизации

## Масштабирование

**Для LLM-исполнителей:**
- `notion-brain/` читается как контекст проекта
- `docs/protocol-kontraktnaya-model-dlya-agentov.md` — правила работы
- `docs/state-snapshot-current-state.md` — текущее состояние проекта

**Для людей:**
- Notion — место для мышления и планирования
- GitHub — место для исполнения и публикации
- Playbook — связующее звено между ними

## Связано с

- [ADR — Source of truth и зеркалирование](adr-source-of-truth-i-zerkalirovanie.md)
- [Protocol — Контрактная модель для агентов](protocol-kontraktnaya-model-dlya-agentov.md)
- [Think Tank — компактное ядро](think-tank-kompaktnoe-yadro.md)
- [Two-stream Policy](protocol-kontraktnaya-model-dlya-agentov.md#two-stream-policy-работа-с-notion-и-github)

