{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://github.com/utemix-lab/vovaipetrova-core/docs/stories/models/gateway-payload.schema.json",
  "title": "Gateway Payload Schema",
  "description": "JSON Schema для валидации payload Author Gateway (очередь идей, метаданные, отчёты)",
  "definitions": {
    "idea": {
      "type": "object",
      "description": "Элемент очереди идей",
      "required": ["id", "status", "title", "created_at"],
      "properties": {
        "id": {
          "type": "string",
          "description": "Уникальный идентификатор идеи",
          "pattern": "^idea-[a-z0-9-]+$"
        },
        "status": {
          "type": "string",
          "description": "Статус идеи в очереди",
          "enum": ["pending", "approved", "rejected"]
        },
        "title": {
          "type": "string",
          "description": "Название идеи",
          "minLength": 1,
          "maxLength": 200
        },
        "seed_text": {
          "type": "string",
          "description": "Короткое описание идеи для генератора (используется как seed для generate-stories.mjs)",
          "minLength": 10,
          "maxLength": 1000
        },
        "created_at": {
          "type": "string",
          "description": "Время создания идеи (ISO 8601)",
          "pattern": "^[0-9]{4}-[0-9]{2}-[0-9]{2}T[0-9]{2}:[0-9]{2}:[0-9]{2}(\\.[0-9]{3})?Z$"
        },
        "author": {
          "type": "string",
          "description": "Автор идеи",
          "default": "автор"
        }
      },
      "additionalProperties": false
    },
    "storyMeta": {
      "type": "object",
      "description": "Метаданные сгенерированного эпизода Stories",
      "required": ["created", "date"],
      "properties": {
        "created": {
          "type": "boolean",
          "description": "Флаг успешного создания эпизода"
        },
        "date": {
          "type": "string",
          "description": "Дата создания эпизода (YYYY-MM-DD)",
          "pattern": "^[0-9]{4}-[0-9]{2}-[0-9]{2}$"
        },
        "file": {
          "type": "string",
          "description": "Полный путь к файлу эпизода",
          "pattern": "^docs/stories/[0-9]{4}-[0-9]{2}-[0-9]{2}-[a-z0-9-]+\\.md$"
        },
        "filename": {
          "type": "string",
          "description": "Имя файла эпизода",
          "pattern": "^[0-9]{4}-[0-9]{2}-[0-9]{2}-[a-z0-9-]+\\.md$"
        },
        "title": {
          "type": "string",
          "description": "Название эпизода"
        },
        "sources": {
          "type": "array",
          "description": "Массив источников данных для генерации",
          "items": {
            "type": "string"
          }
        },
        "reason": {
          "type": "string",
          "description": "Причина, по которой эпизод не был создан (если created: false)",
          "enum": ["already-exists", "no-sources"]
        }
      },
      "additionalProperties": false
    },
    "gatewayReport": {
      "type": "object",
      "description": "Payload для отправки отчёта в Notion через notion-report.mjs",
      "required": ["title", "message", "executor", "timestamp"],
      "properties": {
        "title": {
          "type": "string",
          "description": "Заголовок отчёта",
          "minLength": 1,
          "maxLength": 200
        },
        "message": {
          "type": "string",
          "description": "Текст сообщения отчёта",
          "minLength": 1
        },
        "filename": {
          "type": "string",
          "description": "Имя файла сгенерированного эпизода",
          "pattern": "^[0-9]{4}-[0-9]{2}-[0-9]{2}-[a-z0-9-]+\\.md$"
        },
        "sources": {
          "type": "array",
          "description": "Массив источников данных",
          "items": {
            "type": "string"
          }
        },
        "timestamp": {
          "type": "string",
          "description": "Время создания отчёта (ISO 8601)",
          "pattern": "^[0-9]{4}-[0-9]{2}-[0-9]{2}T[0-9]{2}:[0-9]{2}:[0-9]{2}(\\.[0-9]{3})?Z$"
        },
        "executor": {
          "type": "string",
          "description": "Исполнитель (author-gateway или Stories Generator)",
          "enum": ["author-gateway", "Stories Generator"]
        },
        "status": {
          "type": "string",
          "description": "Статус выполнения",
          "enum": ["completed", "failed", "pending"]
        },
        "date": {
          "type": "string",
          "description": "Дата создания эпизода (YYYY-MM-DD)",
          "pattern": "^[0-9]{4}-[0-9]{2}-[0-9]{2}$"
        }
      },
      "additionalProperties": false
    }
  },
  "oneOf": [
    {
      "type": "array",
      "description": "Очередь идей (tmp/ideas.json)",
      "items": {
        "$ref": "#/definitions/idea"
      },
      "minItems": 0
    },
    {
      "$ref": "#/definitions/storyMeta"
    },
    {
      "$ref": "#/definitions/gatewayReport"
    }
  ]
}

