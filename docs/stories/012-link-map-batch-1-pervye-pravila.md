---
title: 'Link-map batch-1: первые правила сопоставления'
slug: 012-link-map-batch-1-pervye-pravila
summary: Создание системы правил сопоставления проблемных ссылок через link-map.json.
tags:
  - Story
machine_tags:
  - content/story
status: draft
last_edited_time: null
---

# Link-map batch-1: первые правила сопоставления

TL;DR

- Создан файл link-map.json с правилами сопоставления проблемных ссылок.
- Добавлены exact mappings для service-файлов с Notion ID в названии.
- Создан паттерн для автоматического удаления Notion ID из ссылок.
- Система позволяет резолвить ссылки, которые не могут быть сопоставлены автоматически.
- Дальше — расширение правил и обработка новых типов проблемных ссылок.

**Что произошло.** После исправления ссылок через fix-links остались случаи, когда ссылки не могут быть автоматически сопоставлены по slug. Создан файл `prototype/link-map.json` с правилами сопоставления: exact mappings для конкретных случаев и patterns для массовой обработки.

**Зачем это делали.** Нужна была система для обработки проблемных ссылок без изменения контента docs/. Link-map позволяет резолвить ссылки на service-файлы с Notion ID в названии и автоматически удалять ID из ссылок через паттерны. Это снижает количество broken links без правок в исходных файлах.

**Что получилось.** Добавлены exact mappings для service-файлов: notion-brain-108a7f → notion-brain, context-mapyaml-64b43e → context-map-yaml, template-* файлы. Создан паттерн для автоматического удаления Notion ID: `^(?:docs/)?(.+?)-[0-9a-f]{6,}(?:\\.md)?$` → `$1`. Система интегрирована в `scripts/report-broken-internal-links.mjs`.

**Тех-вставка.** Link-map описан в `prototype/link-map.json` с полями exact и patterns. Скрипт `report-broken-internal-links.mjs` использует link-map для резолва ссылок через функцию `resolveReference()`. Правила применяются после попытки автоматического сопоставления по slug.

**Что дальше.** После создания базовых правил следующий шаг — расширение link-map и обработка новых типов проблемных ссылок. Это позволит снизить количество broken links и улучшить качество навигации.

