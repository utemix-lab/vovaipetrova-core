{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Stories JSONL Schema v1",
  "description": "Schema for stories.v1.jsonl - one JSON object per line",
  "type": "object",
  "required": [
    "slug",
    "tldr",
    "machine_report_md",
    "refs",
    "series_id",
    "updated_at"
  ],
  "properties": {
    "slug": {
      "type": "string",
      "description": "URL-friendly slug for the episode"
    },
    "tldr": {
      "type": "string",
      "description": "Brief summary from front matter"
    },
    "machine_report_md": {
      "type": [
        "string",
        "null"
      ],
      "description": "Content of MACHINE_REPORT section (if exists)"
    },
    "refs": {
      "type": "object",
      "description": "References to PRs and commits",
      "required": [
        "prs",
        "commits"
      ],
      "properties": {
        "prs": {
          "type": "array",
          "description": "Array of PR references",
          "items": {
            "type": "object",
            "required": [
              "number",
              "url"
            ],
            "properties": {
              "number": {
                "type": "integer",
                "description": "PR number"
              },
              "url": {
                "type": "string",
                "description": "PR URL",
                "format": "uri"
              }
            }
          }
        },
        "commits": {
          "type": "array",
          "description": "Array of commit references",
          "items": {
            "type": "object",
            "required": [
              "hash",
              "url"
            ],
            "properties": {
              "hash": {
                "type": "string",
                "description": "Commit hash"
              },
              "url": {
                "type": "string",
                "description": "Commit URL",
                "format": "uri"
              }
            }
          }
        }
      }
    },
    "series_id": {
      "type": [
        "string",
        "null"
      ],
      "description": "Series identifier (if episode belongs to a series)"
    },
    "updated_at": {
      "type": "string",
      "description": "ISO 8601 timestamp of last update",
      "format": "date-time"
    }
  },
  "additionalProperties": false
}