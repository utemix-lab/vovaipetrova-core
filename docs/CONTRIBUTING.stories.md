---
title: CONTRIBUTING — Гайд для авторов и редакторов Stories
slug: contributing-stories
summary: Руководство по созданию и редактированию эпизодов Stories, включая dual-story формат и проверки качества
tags:
  - Story
  - Процесс
machine_tags:
  - content/story
  - theme/process
status: ready
---

# CONTRIBUTING — Гайд для авторов и редакторов Stories

Этот документ описывает процесс создания и редактирования эпизодов Stories для авторов и редакторов.

## О Stories

**Stories** — хроника проекта, эпизоды развития системы. Каждый эпизод документирует событие, решение или изменение в проекте.

- **Расположение**: `docs/stories/`
- **Формат**: Markdown с YAML front matter
- **Шаблон**: `templates/story.md`
- **Просмотр**: https://utemix-lab.github.io/vovaipetrova-core/#stories-panel

## Форматы эпизодов

### Обычный формат (стандартный)

Стандартный эпизод Stories с единой линией повествования:

```markdown
---
title: "XXX — Название эпизода"
slug: "XXX-kratkoe-opisanie"
summary: "Краткая аннотация (1–2 предложения)"
tags: [Story]
machine_tags: [content/story]
status: draft
---

# TL;DR

- Что произошло
- Зачем это делали
- Что получилось или выяснили
- Тех-вставка (2–3 предложения)
- Что дальше

Что произошло: [структурированное описание события]

Зачем это делали: [мотивация и цели]

Что получилось: [результаты и артефакты]

Тех-вставка: [технические детали, 2–3 предложения]

Что дальше: [следующие шаги или планы]
```

### Dual-story формат

Эпизод с двумя параллельными линиями: авторской рефлексией и машинным отчётом.

**Особенности:**
- Авторская линия — художественная рефлексия, нейтральный голос, без персоналий
- Машинная линия — структурированный отчёт по шаблону Stories
- Обе линии публикуются вместе в одном файле

**Front matter для dual-story:**

```yaml
---
title: "XXX — Название эпизода"
slug: "XXX-kratkoe-opisanie"
summary: "Краткая аннотация, описывающая обе линии"
tags: [Story]
machine_tags: [content/story]
status: draft
story_type: dual
machine_report_refs:
  prs: [123, 456]
  commits: ["a1b2c3d", "e4f5g6h"]
  issues: [789]
---
```

**Структура контента:**

```markdown
# TL;DR

- Краткое резюме обеих линий (3–5 пунктов)

<!-- AUTHOR_BLOCK START -->
Авторская рефлексия

Художественный текст, описывающий эмоциональный и философский контекст события.
Нейтральный голос, без персоналий, избегает технических деталей.
<!-- AUTHOR_BLOCK END -->

<!-- MACHINE_REPORT START -->
Что произошло: [структурированное описание события]

Зачем это делали: [мотивация и цели]

Что получилось: [результаты и артефакты]

Тех-вставка: [технические детали, 2–3 предложения]

Что дальше: [следующие шаги или планы]
<!-- MACHINE_REPORT END -->
```

**Подробнее**: см. [CONCEPT.stories-dual.md](./stories/CONCEPT.stories-dual.md)

## Процесс создания эпизода

### Шаг 1: Выбор шаблона

1. **Обычный эпизод**: используйте `templates/story.md`
2. **Dual-story**: используйте `templates/story.md` и добавьте `story_type: dual` в front matter

### Шаг 2: Заполнение front matter

**Обязательные поля:**
- `title` — название эпизода (формат: "XXX — Описание")
- `slug` — kebab-case идентификатор (формат: "XXX-kratkoe-opisanie")
- `summary` — краткая аннотация (1–2 предложения)
- `tags` — массив тегов (минимум `[Story]`)
- `machine_tags` — массив машинных тегов (минимум `[content/story]`)
- `status` — статус эпизода (`draft`, `review`, `ready`)

**Опциональные поля:**
- `story_type: dual` — для dual-story формата
- `machine_report_refs` — ссылки на PR, commits, issues (для dual-story)
- `story_order` — порядковый номер эпизода (извлекается из slug автоматически)

### Шаг 3: Написание контента

**Для обычного эпизода:**
1. Заполните TL;DR (3–5 пунктов)
2. Опишите событие по структуре: Что произошло → Зачем → Что получилось → Тех-вставка → Что дальше
3. Объём: 700–1200 знаков

**Для dual-story:**
1. Заполните TL;DR (общий для обеих линий)
2. Напишите авторскую рефлексию между `<!-- AUTHOR_BLOCK START -->` и `<!-- AUTHOR_BLOCK END -->`
3. Заполните машинный отчёт между `<!-- MACHINE_REPORT START -->` и `<!-- MACHINE_REPORT END -->`
4. Убедитесь, что обе линии заполнены

### Шаг 4: Локальные проверки

Перед созданием PR выполните проверки:

```bash
# Проверка PII (персональных данных)
npm run pii:scan

# Проверка линтинга документации
npm run lint:docs

# Проверка терминологии (KB)
npm run lint:terms

# Проверка нормализации (dry-run)
npm run normalize:dry

# Проверка размера PR
npm run check:pr-size
```

### Шаг 5: Создание PR

1. Создайте ветку: `feat/story-XXX` или `chore/story-XXX`
2. Закоммитьте изменения с сообщением в стиле Conventional Commits:
   ```
   feat(stories): add episode XXX about feature Y
   ```
3. Создайте PR с описанием на **русском языке**
4. Добавьте метку `content/story` или `lane:docs`
5. Убедитесь, что все проверки CI прошли успешно

## Правила оформления

### Общие правила

- ✅ **Язык**: нейтральный голос, без персоналий
- ✅ **Объём**: 700–1200 знаков для машинной части
- ✅ **Формат**: Markdown с YAML front matter
- ✅ **Статус**: начинайте с `draft`, переводите в `review` перед PR, `ready` после мерджа

### Safety Rails (запрещено)

- ❌ Использовать первое лицо с именами реальных людей
- ❌ Указывать пути пользователей (например: `<user-path>`)
- ❌ Указывать email, телефоны, адреса реальных людей
- ❌ Использовать разговорные элементы, вопросы к пользователю или предложения помощи
- ❌ Создавать файлы без front matter
- ❌ Менять slug существующих файлов без миграции

### Разрешено

- ✅ Использовать анонимные плейсхолдеры: `[Имя]`, `[Email]`
- ✅ Использовать вымышленные данные для примеров
- ✅ Указывать технические пути: `scripts/`, `docs/`, `prototype/`
- ✅ Ссылаться на PR, commits, issues по номерам

### Dual-story специфичные правила

- ✅ Авторская часть должна быть нейтральной, без персоналий
- ✅ Машинная часть должна быть фактологической и структурированной
- ✅ Обе линии должны быть заполнены (AUTHOR_BLOCK и MACHINE_REPORT)
- ✅ Front matter должен содержать `story_type: dual`
- ✅ `machine_report_refs` должны быть заполнены (если применимо)

## Проверки и валидации

### Автоматические проверки (CI)

При создании PR автоматически выполняются:

1. **Content lint** (`lint:docs`) — проверка структуры, front matter, тегов
2. **Term lint** (`lint:terms`) — проверка терминологии KB
3. **PII scan** (`pii:scan`) — проверка на персональные данные
4. **Guardrails v2** — проверка размера PR, запрещённых путей, PII
5. **Link regression** — проверка на регрессию ссылок
6. **Normalize dry-run** — проверка нормализации без изменений

### Локальные проверки (перед PR)

**Обязательные:**
```bash
npm run pii:scan          # Проверка PII
npm run lint:docs         # Проверка линтинга
npm run normalize:dry     # Проверка нормализации
```

**Рекомендуемые:**
```bash
npm run lint:terms        # Проверка терминологии
npm run check:pr-size     # Проверка размера PR
npm run check:lanes       # Проверка lanes policy
```

### Чек-лист перед PR

**Front matter:**
- [ ] Все обязательные поля заполнены (`title`, `slug`, `summary`, `tags`, `machine_tags`, `status`)
- [ ] Для dual-story: `story_type: dual` указан
- [ ] Slug соответствует формату: `XXX-kratkoe-opisanie`
- [ ] Статус установлен правильно (`draft` → `review` → `ready`)

**Контент:**
- [ ] TL;DR заполнен (3–5 пунктов)
- [ ] Структура соблюдена (Что произошло → Зачем → Что получилось → Тех-вставка → Что дальше)
- [ ] Объём соответствует требованиям (700–1200 знаков)
- [ ] Для dual-story: обе линии заполнены (AUTHOR_BLOCK и MACHINE_REPORT)

**Проверки:**
- [ ] `npm run pii:scan` — нет PII
- [ ] `npm run lint:docs` — нет ошибок линтинга
- [ ] `npm run normalize:dry` — нормализация не меняет файл
- [ ] `npm run lint:terms` — терминология корректна

**PR:**
- [ ] Описание PR на русском языке
- [ ] Добавлена метка `content/story` или `lane:docs`
- [ ] Все проверки CI прошли успешно
- [ ] Старые комментарии ботов удалены (`npm run pr:clear-bot-comments`)

## Статусы эпизодов

- **`draft`** — черновик, работа в процессе
- **`review`** — готов к проверке, создан PR
- **`ready`** — готов к публикации, PR вмержен

## Автоматическая генерация

Эпизоды могут создаваться автоматически через `scripts/generate-stories.mjs`:

1. Генератор читает CHANGELOG.md, ADR, stats.json, Briefs
2. Извлекает факты и события
3. Создаёт машинный отчёт по шаблону
4. Для dual-story: авторская часть добавляется вручную или через human-in-the-loop процесс

**Запуск генератора:**
```bash
npm run story:generate
```

## Связанные документы

- [CONCEPT.stories-dual.md](./stories/CONCEPT.stories-dual.md) — спецификация dual-story формата
- [SHARED_CONTEXT.md](./stories/SHARED_CONTEXT.md) — общий контекст для работы с Stories
- [protocol-kontraktnaya-model-dlya-agentov.md](./protocol-kontraktnaya-model-dlya-agentov.md) — правила работы агентов
- [CONTRIBUTING.md](../CONTRIBUTING.md) — общий гайд по контрибуции
- [templates/story.md](../templates/story.md) — шаблон для создания эпизодов

## Вопросы и поддержка

Если у вас есть вопросы по созданию или редактированию эпизодов Stories:

1. Проверьте этот документ и связанные документы
2. Посмотрите примеры в `docs/stories/`
3. Создайте Issue в репозитории с меткой `question` или `documentation`

